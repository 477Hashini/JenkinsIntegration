pipeline{
    agent any
   
    stages{
        stage('Build'){
            steps{
                echo "Cloning code from the repository://github.com/477Hashini/JenkinsIntegration.git"
                echo "Initiating the build process using Maven"
                echo "Build process completed"
            }
        }

        stage('Unit and Integration Tests'){
            steps{
                echo "Executing unit tests with NUnit"
                echo "Unit tests completed successfully."
                echo "Performing integration tests with Selenium"
                echo "Integration tests finished."
            }
            post {
                failure {
                    emailext(
                        to: 'hashini.amarasena@gmail',
                        subject: "Unit and Integration Test Failed",
                        body: 'Unit and Integration Test failed. Please check the attached logs for more details.',
                        attachLog: true 
                    )      
                }
                success {
                    emailext(
                        to: 'hashini.amarasena@gmail.com',
                        subject: 'Unit and Integration Test Passed',
                        body: 'Unit and Integration Test have passed successfully. Check the attached logs for details.',
                        attachLog: true     
                    ) 
                }
            }

        }

        stage('Code Analysis'){
            steps{
                echo "Initiating code analysis with Veracode"
                echo "Code analysis completed"
            }
        }

        stage('Security Scan'){
            steps{
                echo "Performing security scans with 42Crunch"
                echo "Security scans completed"
            }
            post {
                failure {
                    emailext(
                        to: '',
                        subject: 'Security Scan Failed',
                        body: 'Security Scan has detected issues. Please check the attached logs for details.',
                        attachLog: true  
                    ) 
                }
                success {
                    emailext(
                        to: 'hashini.amarasena@gmail.com',
                        subject: 'Security Scan Succeeded',
                        body: 'Security Scan completed successfully. No issues found. Check the attached logs for details.',
                        attachLog: true 
                    )   
                }
            }
        }

        stage('Deploy to Staging'){
            steps{
                echo "Initiating deployment to the staging environment"
                echo "Deployed to AWS EC2 instance with ID: i-1734567880abcdef0 (staging server)"
            }
        }

        stage('Integration Tests on Staging'){
            steps{
                echo "Executing integration tests on the staging environment using Selenium"
                echo "Integration tests on staging completed successfully."
            }
        }

        stage('Deploy to Production') {
            steps {
                echo "Initiating deployment to the production environment"
                echo "Deployed to AWS EC2 instance with ID: i-1734567880abcdef0 (production server)"
            }
        }
    }
}
